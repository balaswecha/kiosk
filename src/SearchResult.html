<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search results</title>
    <script src="main.js"></script>
    <link rel="stylesheet" href="koisk-default.css" />
</head>
<body>
<div class="topbar">
    <p><a href="index.html">Back</a></p>
    <h1 class="logo">Balaswecha</h1>
    <form id="search-form" class="search" action="SearchResult.html" method="get">
        <input class="search__query" placeholder="e.g. newton's laws of motion..." type="search" name="query" id="query" title="Search"/>
        <input class="search__submit" type="submit" value="Learn!"/>
    </form>
</div>
<div>
    <ul id="results">

    </ul>
</div>
<script>
    window.$ = window.jQuery = require('./jquery.js');

    $(document).ready(function () {
        var query = window.location.search.substring(1).split('&')[0].split('=')[1];
        search(query)
    });


    function searchWebsite(query, site, done) {
        $.getJSON('https://searx.me/', {q: query + ' site:' + site, format: 'json'}).then(function (res) {
            done(res);
        });
    }


    function renderElement(resultObject) {
        var title = resultObject.title;
        var url = resultObject.url;

        var result = "<li>" +
                "<span data-url='" + url + "' class='result-header' style='cursor: pointer'><h3>" + title + "</h3></span><br/>" +
                "<span class='result-content'>" + resultObject.content + "</span></li>";
        $('#results').append(result);
    }


    var media = {
        text: 'en.wikipedia.org',
        video: 'khanacademy.org'
    };

    function renderResult(medium, results) {
        results.results.forEach(function (res) {
            renderElement(res)
        });
    }

    function search(query) {
        $.each(media, function (medium, site) {
            console.log(site, medium);
            searchWebsite(query, site, function (results) {
                renderResult(medium, results);
            });
        });
    }

    $(document).on('click', '.result-header', function (e) {
        e.preventDefault();
        window.location = "layout.html?q=" + $(this).data('url');

    });

</script>
</body>
</html>
